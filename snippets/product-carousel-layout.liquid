{%- liquid
  assign th_st = settings
  assign product_style = th_st.product_style
  assign cls = st.collection
  if bl != blank
    assign cls = bl
  endif
  assign item_desktop = st.item_desktop
  assign item_mobile = st.item_mobile
  assign limit_products = st.limit_products | plus: 0
  assign carousel_autoplay = st.carousel_autoplay
  assign carousel_loop = st.carousel_loop
  assign carousel_arrows = st.carousel_arrows
  assign column_gap = st.column_gap
  assign enabled_animations = th_st.animations_enabled
  assign collection = collections[cls]
  assign reveal_on_scroll = st.reveal_on_scroll
  assign carousel_pagination = st.carousel_pagination
  assign newitem_desktop = item_desktop | plus: 0.0 | times: 2
-%}
<div
  class="swiper bls__swiper grid-{{ product_style }} hover__show-nav {% if enabled_animations %}scroll-trigger animate--slide-in{% endif %}  {% if reveal_on_scroll %}reveal_on_scroll{% endif %}"
  id="bls__swiper-{{ section.id }}-{{ block.id }}"
  data-section-id="{{ section.id }}-{{ block.id }}"
  data-autoplay="{{ carousel_autoplay }}"
  data-loop="{{ carousel_loop }}"
  data-mobile="{% if product_carousel_layout == "pro_desgin_2" and collection.products.size  != null and collection.products.size != 0 %}1{% else %}2{% endif %}"
  data-tablet="{% if product_carousel_layout == "pro_desgin_2" and collection.products.size  != null and collection.products.size != 0 %}1{% else %}3{% endif %}"
  data-arrow-centerimage="1"
  data-desktop="{% if product_carousel_layout == "pro_desgin_2" and collection.products.size  != null and collection.products.size != 0 %}1{% else %}{{ item_desktop }}{% endif %}" 
  data-spacing="{{ column_gap }}"
  data-item-mobile="{{ item_mobile }}"
  data-pagination-progressbar="{% if carousel_pagination == 'carousel_pagination_progress' %}true{% else %}false{% endif %}"
>
 
  {%- if carousel_arrows != false -%}
    <div class="swipper-next-back">
      <div class="swiper-arrow swiper-next swiper-button-next box-shadow"><i class="icon-chevron-right"></i></div>
      <div class="swiper-arrow swiper-prev swiper-button-prev box-shadow"><i class="icon-chevron-left"></i></div>
    </div>
  {%- endif -%}
  <div
    class="swiper-wrapper {% if carousel_pagination_progress %}mb-45{% endif %}"
    style="--perload-gap: {{ column_gap }}px"
  >
    {%- if collection.products.size == 0 -%}
      {%- for i in (1..limit_products) -%}
        <div class="swiper-slide">
          {% if product_carousel_layout == 'pro_desgin_2' %} 
          <div class="bls__product-item {{ design }} flex flex-nowrap mb-15">
            <div class="bls__product-img overflow-hidden relative col-3 mr-15  mw-100">
              <a role="link" aria-disabled="true">
                {%- render 'placeholder-render' | type: 'product' -%}
              </a>
            </div>
            <div class="bls__product-details flex-1">
              <a role="link" aria-disabled="true">{{ 'products.product.product_placeholder' | t }}</a>
              <div class="bls__product-price mb-7">{%- render 'price' -%}</div>
            </div>
          </div>
          {% else %}
          <div
            class="bls__product-item {% if enabled_animations %}scroll-trigger animate--slide-in{% endif %}"
            {% if enabled_animations %}
              data-cascade
              style="--animation-order: {{ forloop.index }};"
            {% endif %}
          >
            {%- render 'responsive-image' | type: 'product' | cls: 'bls__product-tab-plh' -%}
            <div class="bls__product-details pt-15">
              <a role="link" aria-disabled="true">{{ 'products.product.product_placeholder' | t }}</a>
              <div>{%- render 'price' -%}</div>
            </div>
          </div>
        {% endif %}
         
        </div>
      {%- endfor -%}
    {%- else -%}
      {% if product_carousel_layout == 'pro_desgin_2' %}
      
        {% assign newlimit_products = limit_products | divided_by: newitem_desktop | ceil | minus: 1 %}
        {% if limit_products >= collection.products.size  %}
          {%  assign newlimit_products = collection.products.size | divided_by: newitem_desktop | ceil | minus: 1 %}
        {% endif %}
        {% assign newitem_desktop =  item_desktop | times: 2 %}
        {% for group_index in (0..newlimit_products) %}
          <div class="swiper-slide">
            <div
              id="bls__product-grid-{{ id }}"
              class="row row-cols-xl-{{ item_desktop }} {{ column_gap_tablet }}{{ column_gap_mobile }}"
              style="--bs-gutter-x: {{ column_gap }}px"
              data-id="{{ section.id }}"
              data-d="{{ item_desktop }}"
              data-to="{{ limit_products }}"
            >
            {% assign start_index = group_index | times: newitem_desktop %}
            
            {% assign end_index = start_index | plus: newitem_desktop | minus : 1%}
             {%  if end_index >= limit_products %}
                {% assign end_index = limit_products | minus: 1 %} 
             {% endif %}
         
              {% for product in collection.products %}
                {%  if forloop.index0 >= start_index and forloop.index0 <=  end_index %}
                  <div
                    class="col-lg-4 col-6 bls__product-load {% if enabled_animations %}scroll-trigger animate--slide-in{% endif %}"
                    {% if enabled_animations %}
                      data-cascade
                      style="--animation-order: {{ forloop.index }};"
                    {% endif %}
                  >
                    {% comment %} {%- render 'product-item' | product: product -%} {% endcomment %}
                    {%- assign sold_out = true -%}
                    {%- if product.available -%}
                      {%- assign sold_out = false -%}
                    {%- endif -%}
                    <div class="bls__product-item {{ design }} flex flex-nowrap mb-20 last-0">
                      <div class="bls__product-img overflow-hidden relative col-3 mr-15">
                        <a href="{{ product.url | within: collection }}">
                          {%- if product.featured_image != blank -%}
                            {%- render 'responsive-image' | image: product.featured_image | type: 'product' -%}
                          {%- else -%}
                            {%- render 'placeholder-render' | type: 'product' | cls: 'bls__product-list-plh' -%}
                          {%- endif -%}
                        </a>
                      </div>
                      <div class="bls__product-details flex-1">
                        <h3 class="bls__product-name regular mb-5">
                          <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
                        </h3>
                        <div class="bls__product-review mb-7">
                        {% render 'product-review' | review_star: true | product: product %}
                       </div>
                          <div class="bls__product-price mb-7">
                            {%- render 'price', product: product, use_variant: true, price_class: 'price--large' -%}
                          </div>
                       
                        {%- if sold_out -%}
                          <div>{{ 'products.product.sold_out' | t }}</div>
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                {%  endif %}
              {% endfor %}
           
            
          </div>
        </div>
        {% endfor %}
    
      {% else %}
      {%- for product in collection.products limit: limit_products -%}
        {%- if product.available -%}{%- endif -%}
        <div class="swiper-slide">
             {%- render 'product-item' | product: product -%}
        </div>
      {%- endfor -%}
      {% endif %}
    {%- endif -%}
  </div>
  {%- if carousel_pagination == 'carousel_bullets'
    or carousel_pagination == 'show_bullet_mobile'
    or carousel_pagination == 'carousel_pagination_progress'
  -%}
    <div
      class="swiper-pagination {% if carousel_pagination == 'show_bullet_mobile' %} show-on-mobile {% endif %} {% if enabled_animations %}scroll-trigger animate--slide-in{% endif %}"
    ></div>
  {%- endif -%}
</div>
